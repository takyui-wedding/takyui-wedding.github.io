<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ï½Mystery answerï½</title>
    <script type="text/javascript">
        let submitted = false;
        let userID = '';
    </script>
    <iframe
        name="hidden_iframe"
        id="hidden_iframe"
        style="display: none"
        onload="if(submitted && userID){window.location='correct-answer.html';}else if(submitted){window.location='thanks_absence.html';}"
    ></iframe>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f8f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0; /* ä¸Šä¸‹ã®ä½™ç™½ã‚’è¿½åŠ  */
        }

        .container {
            background-color: #fdf7ef;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 600px;
            height: 1000px;
            background-image: url(image/answer2.jpg);
            background-size:auto; /*èƒŒæ™¯ç”»åƒã®ã‚µã‚¤ã‚ºæŒ‡å®š*/

            /* èƒŒæ™¯ç”»åƒã‚’è¡¨ç¤º */
            /*background-image: url(305505_26.jpg);
            position: relative;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-left: 28px;
            padding-right: 28px;*/
        }

        form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #777;
            font-weight: bold;
        }

        h1 {
            color: #555;
            text-align: center;
            margin-bottom: 30px;
            font-family: "SchoolHouse Cursive B","Times New Roman",sans-serif;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #777;
            font-weight: bold;
        }

        /* å…¨ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ»ãƒ¡ãƒ¼ãƒ«å…¥åŠ›æ¬„ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        input[type="text"]{
            width: 100%; /* Name Groupå†…ã® input ã¯ .name-group input ã§ä¸Šæ›¸ãã•ã‚Œã‚‹ */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; /* paddingã‚’å«ã‚ã¦width 100% ã« */
            font-size: 16px;
        }

        button[type="button"] {
            background-color: #a58faa;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            display: block; /* ä¸­å¤®æƒãˆã®ãŸã‚ã« block è¦ç´ ã« */
            margin: 30px auto 0; /* ä¸Šã«ãƒãƒ¼ã‚¸ãƒ³ã€å·¦å³autoã§ä¸­å¤®æƒãˆ */
            width: auto; /* å¹…ã‚’è‡ªå‹•ã« */
            min-width: 150px; /* æœ€ä½å¹… */
        }

        button[type="button"]:hover {
            background-color: #8c7380;
        }

        .message {
            margin-top: 20px;
            text-align: center;
            color: #555;
        }

        .message span {
            font-size: large;
            font-weight:bold;
            padding: 0 0.1em;
        }

        /* å¿…é ˆãƒãƒ¼ã‚¯ (ä»»æ„) */
        .required-mark {
            color: red;
            font-size: 0.8em;
            margin-left: 4px;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Congratulationsï¼</h1>
        <p class="message">çš†ã•ã‚“ã«ãŠä¼ãˆã—ãŸã‹ã£ãŸè¨€è‘‰ã¯</p>
        <p class="message"><span>ã‚ã‚ŠãŒã¨ã†</span>ã§ã™ğŸŒ¸</p>
        <p class="message">
            ä»Šå›å¤§åˆ‡ãªæ–¹ã€…ã‚’ãŠæ‹›ãã—<br/>
            çµå©šæŠ«éœ²å®´ã‚’é–‹å‚¬ã™ã‚‹ã«ã‚ãŸã‚Š<br/>
            æ–°éƒæ–°å©¦ãŒå¥½ããªè¬è§£ãã‚’ç”¨ã„ã¦<br/>
            æœ€å¤§é™ã®ãŠã‚‚ã¦ãªã—ã‚’ã—ãŸã„ã¨è€ƒãˆ<br/>
            è‡ªä½œã®è¬è§£ãã‚²ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸ<br/>
            <br/>
            æ¥½ã—ã‚“ã§ã„ãŸã ã‘ã¾ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ<br/>
        </p>
        <p class="message">
            æ”¹ã‚ã¦ã®ã”æŒ¨æ‹¶ã«ãªã‚Šã¾ã™ãŒ<br/>
            ç§é”ã¯çš†æ§˜ã«æ”¯ãˆã‚‰ã‚Œ<br/>
            æœ¬æ—¥ã‚’è¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸ<br/>
            <br/>
            çš†ã•ã‚“ã¨éã”ã—ãŸæ—¥ã€…ã¯<br/>
            ç§é”ã«ã¨ã£ã¦ä¸€ç”Ÿã®å®ç‰©ã§ã™<br/>
            ä»Šå¾Œã¨ã‚‚ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™<br/>
            ï¼ˆè¬è§£ãã‚„è„±å‡ºã‚²ãƒ¼ãƒ ãªã©ã‚‚<br/>
            ä¸€ç·’ã«éŠã‚“ã§ãã‚Œã‚‹ã¨å¬‰ã—ã„ã§ã™âœ¨ï¼‰<br/>
        </p>

        <p class="message">
            ã“ã“ã¾ã§ãŠä»˜ãåˆã„ã„ãŸã ã„ãŸçš†æ§˜ã«<br/>
            æ–°éƒæ–°å©¦ã‹ã‚‰ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆãŒã”ã–ã„ã¾ã™<br/>
            <br/>
            <b>ã“ã®å ´ã«ã„ã‚‹ãã£ã‹ã‘</b>ã¨ãªã£ãŸã‚‚ã®ã«<br/>
            è¨˜è¼‰ã®ã‚ã‚‹ã€Œã”è‡ªèº«ã®IDã€ã‚’å…¥åŠ›ã—<br/>
            ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’å—ã‘å–ã£ã¦ãã ã•ã„<br/>
        </p>
        <form method="post" onsubmit="submitted=true;" class="c-form">
            <div id="attendance-details">
                <div class="form-group">
                    <label>ã‚ãªãŸè‡ªèº«ã®IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„<span class="required-mark">*</span></label>
                    <div class="name-group">
                        <input type="text" id="guestId" name="guestId" required>
                    </div>
                </div>
            </div>
             <button type="button" id="submitButton">é€ä¿¡ã™ã‚‹</button>
        </form>
    </div>

    <script>
        // ãƒœã‚¿ãƒ³è¦ç´ ã¨å…¥åŠ›è¦ç´ ã‚’å–å¾—
        const submitButton = document.getElementById('submitButton');
        const guestIdText = document.getElementById('guestId');

        // é€ä¿¡ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
        submitButton.addEventListener('click', async () => {
            const guestId = guestIdText.value.trim(); // å…¥åŠ›å€¤ã‚’å–å¾—ã—ã€å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤

            // IDãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (!guestId) {
                alert('IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return; // IDãŒç©ºãªã‚‰å‡¦ç†ã‚’ä¸­æ–­
            }

            // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ™ãƒ¼ã‚¹URL (å®Ÿéš›ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„)
            const baseUrl = 'https://script.google.com/macros/s/AKfycbxlXXRkMNBqmNQLmMCVOfyKlDY0h9VijZcG3j9CNQGoE5bnNv9k0601QozsFOr_Duz-/exec';
            // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ã‘ã¦URLã‚’æ§‹ç¯‰ (IDã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹)
            const apiUrl = `${baseUrl}?method=å‹•ç”»URLå–å¾—&guestId=${encodeURIComponent(guestId)}`;

            try {
                // fetch APIã‚’ä½¿ç”¨ã—ã¦GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        // å¿…è¦ã«å¿œã˜ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
                        'Accept': 'application/json' // ã‚µãƒ¼ãƒãƒ¼ãŒJSONã‚’è¿”ã™ã“ã¨ã‚’æœŸå¾…
                    }
                });

                // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
                if (response.ok) {
                    // ã‚µãƒ¼ãƒãƒ¼å‡¦ç†ãŒæ­£å¸¸çµ‚äº† (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ 200-299)
                    try {
                        const data = await response.json(); // å¿œç­”ãƒœãƒ‡ã‚£ã‚’JSONã¨ã—ã¦è§£æ
                        if (data && data.movieUrrl) {
                            // redirectUrl ãŒå­˜åœ¨ã™ã‚Œã°ã€ãã®URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                            console.log('ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™:', data.movieUrrl);
                            alert('ã‚ãªãŸã¨ã®æ€ã„å‡ºã‚’ãŠè¦‹ã›ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ã€‚');
                            window.location.href = data.movieUrrl;
                        } else {
                            // æ­£å¸¸çµ‚äº†ã—ãŸãŒã€æœŸå¾…ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ãªã„å ´åˆ
                            console.error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã«redirectUrlãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚', data);
                            alert('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒäºˆæœŸã—ãªã„å½¢å¼ã§ã™ã€‚');
                        }
                    } catch (jsonError) {
                        // JSONè§£æã«å¤±æ•—ã—ãŸå ´åˆ
                        console.error('JSONè§£æã‚¨ãƒ©ãƒ¼:', jsonError);
                        alert('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’å‡¦ç†ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                    }
                } else {
                    // ã‚µãƒ¼ãƒãƒ¼å‡¦ç†ãŒç•°å¸¸çµ‚äº† (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ 4xx, 5xx ãªã©)
                    console.error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼:', response.status, response.statusText);
                    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ„ã¿ç«‹ã¦ (å¯èƒ½ã§ã‚ã‚Œã°ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®è©³ç´°ã‚’ä½¿ã†)
                    let errorMessage = `ã‚µãƒ¼ãƒãƒ¼å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\nã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`;
                    try {
                        // ã‚µãƒ¼ãƒãƒ¼ãŒã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§è¿”ã—ã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚’è¡¨ç¤º
                        const errorText = await response.text();
                        if(errorText) {
                            errorMessage += `\nè©³ç´°: ${errorText}`;
                        }
                    } catch (textError) {
                        // ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å–å¾—ã«å¤±æ•—ã—ãŸå ´åˆ
                         console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å–å¾—å¤±æ•—:', textError);
                    }
                    alert(errorMessage);
                }
            } catch (networkError) {
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„fetchè‡ªä½“ã®å¤±æ•—
                console.error('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼:', networkError);
                alert('ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡ä¸­ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        });
    </script>
</body>
</html>
